{
  "scopeName": "source.watson",
  "patterns": [
    { "include": "#comments" },
    { "include": "#simple-command" },
    { "include": "#block-command" }
  ],
  "repository": {
    "simple-command": {
      "patterns": [
        {
          "match": "^(module|syntax_category|tactic_category)\\s+([\\w_'][\\w_'\\d\\.]*)",
          "captures": {
            "1": { "name": "keyword.other.watson" },
            "2": { "name": "entity.name.function.watson" }
          },
          "name": "meta.simple-command.watson"
        }
      ]
    },
    "block-command": {
      "patterns": [
        {
          "begin": "^(syntax|tactic|notation|theorem|axiom|definition)\\s+",
          "beginCaptures": {
            "1": { "name": "keyword.other.watson" }
          },
          "end": "\\b(end|qed)\\b",
          "endCaptures": {
            "1": { "name": "keyword.other.watson" }
          },
          "name": "meta.command.watson",
          "patterns": [
            { "include": "#command-name-first" },
            { "include": "#command-content" }
          ]
        }
      ]
    },
    "command-name-first": {
      "patterns": [
        {
          "match": "\\G([\\w_'][\\w_'\\d\\.]*)",
          "captures": {
            "1": { "name": "entity.name.function.watson" }
          }
        }
      ]
    },
    "command-content": {
      "patterns": [
        { "include": "#comments" },
        { "include": "#strings" },
        { "include": "#proof-block" },
        { "include": "#by-theorem" },
        { "include": "#keywords" },
        { "include": "#operators" }
      ]
    },
    "by-theorem": {
      "patterns": [
        {
          "match": "\\b(by)\\s+([\\w_'][\\w_'\\d\\.]*)",
          "captures": {
            "1": { "name": "keyword.control.watson" },
            "2": { "name": "entity.name.function.watson" }
          }
        }
      ]
    },
    "proof-block": {
      "patterns": [
        {
          "begin": "\\b(proof)\\b",
          "beginCaptures": {
            "1": { "name": "keyword.other.watson" }
          },
          "end": "(?=\\b(qed)\\b)",
          "name": "meta.proof.watson",
          "patterns": [
            { "include": "#comments" },
            { "include": "#strings" },
            { "include": "#by-theorem" },
            { "include": "#keywords" },
            { "include": "#operators" }
          ]
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "match": "\\b(have|as|assume)\\b",
          "name": "keyword.control.watson"
        },
        {
          "match": "\\b(todo)\\b",
          "name": "invalid.illegal.watson"
        },
        {
          "match": "(@kw|@template|@variable|@binding|@fact|@fragment|@any_fragment|@name)\\b",
          "name": "keyword.other.watson"
        }      ]
    },
    "comments": {
      "patterns": [
        {
          "begin": "--",
          "end": "$",
          "name": "comment.line.double-dash.watson"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "match": "(\\|-)|(::=)|(=>)|(:=)|;|:",
          "name": "keyword.operator.watson"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "begin": "\"",
          "end": "\"",
          "name": "string.quoted.double.watson"
        }
      ]
    }
  }
}
